---
import { experienceData } from '../data/siteData';
---

<section id="experience" class="py-24 bg-transparent relative overflow-hidden">
  <div class="container mx-auto px-6 relative z-10">
    <div class="text-center mb-16">
      <h2 class="text-4xl md:text-5xl font-bold text-bright mb-4 uppercase tracking-wider title-underline">{experienceData.title}</h2>
      <p class="text-xl text-sw-yellow font-medium text-glow-yellow subtitle-accent">{experienceData.subtitle}</p>
    </div>

    <!-- Timeline -->
    <div class="relative max-w-5xl mx-auto px-4 md:px-0">
      <!-- Vertical line -->
      <div class="absolute left-6 md:left-1/2 top-0 bottom-0 w-0.5 bg-gradient-to-b from-sw-yellow via-sw-yellow to-transparent timeline-line"></div>

      <!-- Experience items -->
      <div class="space-y-12">
        {experienceData.experiences.map((exp, index) => (
          <div
            class={`experience-item relative flex flex-col md:flex-row ${index % 2 === 0 ? 'md:flex-row-reverse' : ''} gap-8 items-center`}
            data-index={index}
          >
            <!-- Timeline dot -->
            <div class="absolute left-6 md:left-1/2 w-4 h-4 bg-sw-yellow rounded-full border-4 border-black transform -translate-x-1/2 timeline-dot shadow-[0_0_20px_rgba(255,232,31,0.8)] z-10"></div>

            <!-- Content card -->
            <div class={`w-full md:w-[calc(50%-3rem)] text-center ${index % 2 === 0 ? 'md:text-right' : 'md:text-left'} pl-12 md:pl-0 md:ml-0`}>
              <div class="experience-card bg-sw-yellow/20 backdrop-blur-sm border border-sw-yellow/30 rounded-lg p-6 shadow-[0_0_16px_rgba(255,232,31,0.3)] hover:shadow-[0_0_24px_rgba(255,232,31,0.5)] transition-all duration-300">
                <!-- Year badge -->
                <div class={`inline-block mb-4 px-4 py-2 bg-sw-yellow text-black font-bold text-sm uppercase tracking-wider ${index % 2 === 0 ? 'md:float-right md:ml-4' : 'md:float-left md:mr-4'}`}>
                  {exp.year}
                </div>

                <h3 class="text-2xl font-bold text-sw-yellow mb-2 uppercase tracking-wide clear-both">
                  {exp.title}
                </h3>
                <p class="text-lg text-bright font-semibold mb-1">{exp.company}</p>
                {exp.project && (
                  <p class="text-base text-sw-yellow/80 font-medium mb-3 italic">
                    Proyecto: {exp.project}
                  </p>
                )}
                <p class="text-enhanced mb-4 leading-relaxed">{exp.description}</p>

                <!-- Technologies -->
                <div class={`flex flex-wrap gap-2 justify-center ${index % 2 === 0 ? 'md:justify-end' : 'md:justify-start'}`}>
                  {exp.technologies.map((tech) => (
                    <span class="px-3 py-1 bg-black/50 text-sw-yellow text-xs font-bold border border-sw-yellow/30 rounded">
                      {tech}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>

      <!-- End marker -->
      <div class="relative mt-12 flex justify-center">
        <div class="w-6 h-6 bg-sw-yellow rounded-full border-4 border-black shadow-[0_0_30px_rgba(255,232,31,1)] animate-pulse"></div>
      </div>
    </div>
  </div>
</section>

<style>
  /* Timeline line animation */
  .timeline-line {
    opacity: 0;
    animation: lineGrow 2s ease-out forwards;
  }

  @keyframes lineGrow {
    from {
      height: 0%;
      opacity: 0;
    }
    to {
      height: 100%;
      opacity: 1;
    }
  }

  /* Timeline dots fade in */
  .timeline-dot {
    opacity: 0;
    transform: translate(-50%, 0) scale(0);
  }

  /* Experience cards slide in */
  .experience-card {
    opacity: 0;
    transform: translateY(30px);
  }

  /* Animation will be triggered by Intersection Observer */
  .experience-item.visible .timeline-dot {
    animation: dotAppear 0.6s ease-out forwards;
  }

  .experience-item.visible .experience-card {
    animation: cardSlideIn 0.8s ease-out forwards;
  }

  @keyframes dotAppear {
    0% {
      opacity: 0;
      transform: translate(-50%, 0) scale(0);
    }
    50% {
      transform: translate(-50%, 0) scale(1.3);
    }
    100% {
      opacity: 1;
      transform: translate(-50%, 0) scale(1);
    }
  }

  @keyframes cardSlideIn {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  // Intersection Observer for scroll animations
  const observerOptions = {
    threshold: 0.2,
    rootMargin: '0px 0px -100px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        // Optional: unobserve after animation to prevent re-triggering
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // Observe all experience items
  document.querySelectorAll('.experience-item').forEach((item) => {
    observer.observe(item);
  });
</script>
